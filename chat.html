<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØºØ±ÙØ© Ø§Ù„Ø´Ø§Øª - Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙØ±ÙŠ Ù„Ø§Ù†ì‹±</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .chat-container {
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: 8px 8px 0 0;
        }
        .order-info {
            background: var(--light);
            padding: 1rem;
            font-size: 0.9rem;
        }
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: white;
        }
        .message {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 18px;
            max-width: 70%;
            word-wrap: break-word;
        }
        .customer-message {
            background: var(--primary);
            color: white;
            margin-left: auto;
        }
        .editor-message {
            background: var(--light);
            color: var(--dark);
            margin-right: auto;
        }
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }
        .chat-input {
            display: flex;
            padding: 1rem;
            background: white;
            border-top: 1px solid var(--border);
            border-radius: 0 0 8px 8px;
        }
        #message-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 20px;
            margin-left: 0.5rem;
        }
        #send-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            margin-left: 5px;
        }
        .file-upload {
            margin: 1rem 0;
            padding: 1rem;
            background: var(--light);
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo">ğŸ’¼ ÙØ±ÙŠ Ù„Ø§Ù†Ø³Ø±</a>
                <div class="nav-links">
                    <a href="categories.html" class="nav-link">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
                    <a href="editor-login.html" class="nav-link">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­Ø±Ø±ÙŠÙ†</a>
                    <a href="#" class="nav-link">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="container mt-4">
        <div class="card chat-container">
            <div class="chat-header">
                <h2>ğŸ’¬ ØºØ±ÙØ© Ø§Ù„Ø´Ø§Øª</h2>
                <div>Ø§Ù„Ù…Ø­Ø±Ø±: <span class="status-indicator"></span> Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ (Ù…ØªØµÙ„)</div>
            </div>
            
            <div class="order-info" id="order-info">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
            
            <div class="chat-messages" id="chat-messages">
                <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
            
            <div class="file-upload">
                <label class="btn" style="margin: 0;">
                    <input type="file" id="file-input" style="display: none;" multiple>
                    ğŸ“ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª
                </label>
                <small class="text-muted" style="display: block; margin-top: 0.5rem;">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ± Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø£Ùˆ Ù…Ø³ØªÙ†Ø¯Ø§Øª</small>
            </div>
            
            <div class="chat-input">
                <input type="text" id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." onkeypress="handleKeyPress(event)">
                <button id="send-btn" onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </main>

    <footer style="background: var(--dark); color: white; text-align: center; padding: 2rem 0; margin-top: 3rem;">
        <div class="container">
            <p>&copy; 2024 Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙØ±ÙŠ Ù„Ø§Ù†ì‹±. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        </div>
    </footer>

    <script>
        const orderData = JSON.parse(localStorage.getItem('currentOrder'));
        
        if (orderData) {
            document.getElementById('order-info').innerHTML = `
                <strong>Ø§Ù„Ø·Ù„Ø¨:</strong> ${orderData.serviceName} | 
                <strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${orderData.orderId} |
                <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="color: var(--warning);">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
            `;
        }

        let messages = JSON.parse(localStorage.getItem('chatMessages')) || [];

        function displayMessages() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.sender}-message`;
                messageDiv.innerHTML = `
                    <div>${msg.text}</div>
                    <div class="message-time">${formatTime(msg.timestamp)}</div>
                `;
                messagesContainer.appendChild(messageDiv);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (text) {
                const message = {
                    text: text,
                    sender: 'customer',
                    timestamp: new Date().toISOString()
                };
                
                messages.push(message);
                localStorage.setItem('chatMessages', JSON.stringify(messages));
                
                displayMessages();
                input.value = '';
                
                setTimeout(simulateEditorReply, 2000);
            }
        }

        function simulateEditorReply() {
            const replies = [
                "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨ÙƒØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©",
                "Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§ØŸ",
                "Ø³Ø£Ø¨Ø¯Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ³ÙŠØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯",
                "ØªÙ… ÙÙ‡Ù… Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§ØªØŒ Ø³Ø£Ø¨Ø¯Ø£ ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙˆØ±Ø§Ù‹",
                "Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¶ÙŠØ­ Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ØŸ"
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            
            const message = {
                text: randomReply,
                sender: 'editor',
                timestamp: new Date().toISOString()
            };
            
            messages.push(message);
            localStorage.setItem('chatMessages', JSON.stringify(messages));
            
            displayMessages();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('ar-EG', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        document.getElementById('file-input').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const message = {
                    text: `ğŸ“ ØªÙ… Ø¥Ø±ÙØ§Ù‚ ${e.target.files.length} Ù…Ù„Ù`,
                    sender: 'customer',
                    timestamp: new Date().toISOString()
                };
                
                messages.push(message);
                localStorage.setItem('chatMessages', JSON.stringify(messages));
                displayMessages();
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ Ø§Ù„Ù…Ø­Ø±Ø±
                setTimeout(() => {
                    const reply = {
                        text: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§ØªØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ø§Ù„Ø¢Ù†",
                        sender: 'editor',
                        timestamp: new Date().toISOString()
                    };
                    
                    messages.push(reply);
                    localStorage.setItem('chatMessages', JSON.stringify(messages));
                    displayMessages();
                }, 1500);
            }
        });

        displayMessages();

        if (messages.length === 0) {
            const welcomeMessage = {
                text: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ØŒ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø·Ù„Ø¨Ùƒ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ",
                sender: 'editor',
                timestamp: new Date().toISOString()
            };
            messages.push(welcomeMessage);
            localStorage.setItem('chatMessages', JSON.stringify(messages));
            displayMessages();
        }
    </script>
</body>
</html>